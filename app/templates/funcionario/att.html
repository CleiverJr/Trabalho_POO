{% extends "templs/navfunc.html" %}
{% block title %} Atualizar Cadastro {% endblock %}
{% block style %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/att.css') }}"> {% endblock %}
{% block content %}
<form id="dynamicForm" class="w-100" method="POST" action="/att">
    <!-- Dropdown Principal -->
    <div class="mb-5 w-50">
        <label for="userType" class="form-label text-white fs-2 fw-bold mb-3">Selecione o Tipo de Usuário:</label>
        <select id="userType" name="tipo" class="form-select w-50" onchange="updateForm()">
            <option value="Cliente">Cliente</option>
            <option value="Funcionário">Funcionário</option>
        </select>
    </div>

    <!-- Inputs para Cliente -->
    <div id="clienteInputs">
        <div class="row">
            <div class="col-md-4">
                <div class="mb-5">
                    <input name="clienteNome" type="text" class="form-control" id="clienteNome" placeholder="Nome">
                </div>
                <div class="mb-5">
                    <input name="clienteEmail" type="email" class="form-control" id="clienteEmail" placeholder="Email">
                </div>
                <div class="mb-5">
                    <input name="clienteDepartamentos" type="text" class="form-control" id="clienteDepartamentos" placeholder="Departamentos">
                </div>
                <div class="mb-5">
                    <input name="clienteReceita" type="text" class="form-control" id="clienteReceita" placeholder="Receita">
                </div>
            </div>
            <div class="col-md-4">
                <div class="mb-5">
                    <label id="identifierLabel" class="form-label text-white fs-4 fw-bold"></label>
                    <select name="identifierSelect" id="identifierSelect" class="form-select" onchange="loadUserData()">
                        <!-- Options serão carregadas dinamicamente -->
                    </select>
                </div>
                <div class="mb-5">
                    <input name="clienteSede" type="text" class="form-control" id="clienteSede" placeholder="Sede">
                </div>
                <div class="mb-5">
                    <input name="clienteFuncionarios" type="text" class="form-control" id="clienteFuncionarios" placeholder="N° de Funcionários">
                </div>
                <div class="mb-5">
                    <input name="clientePv" type="text" class="form-control" id="clientePv" placeholder="Proposta de valor">
                </div>
            </div>
            <div class="col-md-4">
                <div class="mb-5">
                    <input name="clienteTelefone" type="text" class="form-control" id="clienteTelefone" placeholder="Telefone">
                </div>
                <div class="mb-5">
                    <input name="clienteIndústria" type="text" class="form-control" id="clienteIndústria" placeholder="Indústria">
                </div>
                <div class="mb-5">
                    <input name="clienteCapital" type="text" class="form-control" id="clienteCapital" placeholder="Capital">
                </div>
                <div class="mb-5">
                    <input name="clienteSenha" type="text" class="form-control" id="clienteSenha" placeholder="Senha">
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-center mt-4 gap-3">
            <button type="submit" class="btn UIButton" onclick="atualizarCliente()">Atualizar Cliente</button>
        </div>
    </div>


    <!-- Inputs para Funcionário -->
    <div id="funcionarioInputs" class="hidden">
        <div class="row">
            <div class="col-md-4">
                <div class="mb-5">
                    <input name="funcionarioNome" type="text" class="form-control" id="funcionarioNome" placeholder="Nome">
                </div>
                <div class="mb-5">
                    <input name="funcionarioEmail" type="email" class="form-control" id="funcionarioEmail" placeholder="Email">
                </div>
                <div class="mb-5">
                    <input name="funcionarioSalario" type="text" class="form-control" id="funcionarioSalario" placeholder="Salário">
                </div>
                <div class="mb-5">
                    <input name="funcionarioSenha" type="text" class="form-control" id="funcionarioSenha" placeholder="Senha">
                </div>
            </div>
            <div class="col-md-4">
                <div class="mb-5">
                    <input name="funcionarioCpf" type="text" class="form-control" id="funcionarioCpf" placeholder="CPF">
                </div>
                <div class="mb-5">
                    <input name="funcionarioCep" type="text" class="form-control" id="funcionarioCep" placeholder="CEP">
                </div>
                <div class="mb-5">
                    <input name="funcionarioFormação" type="text" class="form-control" id="funcionarioFormação" placeholder="Formação">
                </div>
                <div class="mb-5">
                    <input name="funcionarioTipo" type="text" class="form-control" id="funcionarioTipo" placeholder="Tipo">
                </div>
            </div>
            <div class="col-md-4">
                <div class="mb-5">
                    <input name="funcionarioTelefone" type="text" class="form-control" id="funcionarioTelefone" placeholder="Telefone">
                </div>
                <div class="mb-5">
                    <input name="funcionarioCargo" type="text" class="form-control" id="funcionarioCargo" placeholder="Cargo">
                </div>
                <div class="mb-5">
                    <input name="funcionarioIdade" type="text" class="form-control" id="funcionarioIdade" placeholder="Idade">
                </div>
                <div class="mb-5">
                    <input name="funcionarioGrau" type="text" class="form-control" id="funcionarioGrau" placeholder="Grau">
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-center mt-4 gap-3">
            <button type="submit" class="btn UIButton" onclick="atualizarFuncionario()">Atualizar Funcionário</button>
        </div>
    </div>

</form>
{% endblock %}
{% block script %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        updateForm();
    });

    function updateForm() {
        const userType = document.getElementById("userType").value;
        const clienteInputs = document.getElementById("clienteInputs");
        const funcionarioInputs = document.getElementById("funcionarioInputs");
        const identifierLabel = document.getElementById("identifierLabel");
        const identifierSelect = document.getElementById("identifierSelect");

        if (userType === "Cliente") {
            clienteInputs.style.display = "block";
            funcionarioInputs.style.display = "none";
            identifierLabel.textContent = "Selecione o CNPJ:";
            fetchOptions("Cliente");
        } else if (userType === "Funcionário") {
            funcionarioInputs.style.display = "block";
            clienteInputs.style.display = "none";
            identifierLabel.textContent = "Selecione o CPF:";
            fetchOptions("Funcionário");
        }
    }

    async function fetchOptions(userType) {
        try {
            const response = await fetch(/get_identifiers?type=${userType});
            const data = await response.json();
            const identifierSelect = document.getElementById("identifierSelect");
            identifierSelect.innerHTML = ""; // Limpa as opções existentes

            data.forEach(identifier => {
                const option = document.createElement("option");
                option.value = identifier;
                option.textContent = identifier;
                identifierSelect.appendChild(option);
            });
        } catch (error) {
            console.error("Erro ao buscar identificadores:", error);
        }
    }

    async function loadUserData() {
        const identifier = document.getElementById("identifierSelect").value;
        const userType = document.getElementById("userType").value;

        try {
            const response = await fetch(/get_user_data?type=${userType}&id=${identifier});
            const userData = await response.json();

            // Preenche os campos com os dados do usuário
            for (const [key, value] of Object.entries(userData)) {
                const input = document.getElementById(key);
                if (input) {
                    input.value = value;
                }
            }
        } catch (error) {
            console.error("Erro ao carregar dados do usuário:", error);
        }
    }

    function submitForm(event) {
        event.preventDefault();
        const form = document.getElementById("dynamicForm");
        // Implemente o envio do formulário aqui, se necessário
        alert("Formulário enviado!");
    }
</script>

{% endblock %}